# DevLoop Configuration for APEX Asia Property Exchange
# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ Ñ€Ð°Ð·Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¸ Ð´ÐµÐ¿Ð»Ð¾Ð¹

name: "APEX Admin Panel Development"
description: "Ð£Ð½Ð¸Ð²ÐµÑ€ÑÐ°Ð»ÑŒÐ½Ð°Ñ Ð°Ð´Ð¼Ð¸Ð½-Ð¿Ð°Ð½ÐµÐ»ÑŒ Ð´Ð»Ñ Ñ‚ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… ÑÐ¸ÑÑ‚ÐµÐ¼"

# ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
settings:
  auto_commit: true
  auto_push: false
  create_pull_requests: true
  branch_prefix: "feature/"
  commit_prefix: "ðŸš€"
  
# ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ñ„Ð°Ð¹Ð»Ð¾Ð²
watch:
  - "admin_panel/**/*.py"
  - "admin_panel/**/*.html"
  - "admin_panel/**/*.css"
  - "admin_panel/**/*.js"
  - "docker-compose*.yml"
  - "*.md"
  
# Ð˜Ð³Ð½Ð¾Ñ€Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹
ignore:
  - "**/__pycache__/**"
  - "**/*.pyc"
  - "**/.DS_Store"
  - "**/venv/**"
  - "**/node_modules/**"
  - "**/.git/**"
  - "**/logs/**"
  - "**/media/**"
  - "**/staticfiles/**"

# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
actions:
  # Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
  test:
    command: "cd admin_panel && source venv/bin/activate && python manage.py test tests -v 2"
    on_change: ["admin_panel/**/*.py"]
    timeout: 300
    
  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð´Ð°
  lint:
    command: "cd admin_panel && source venv/bin/activate && python manage.py check"
    on_change: ["admin_panel/**/*.py"]
    timeout: 60
    
  # ÐœÐ¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸
  migrate:
    command: "cd admin_panel && source venv/bin/activate && python manage.py migrate"
    on_change: ["admin_panel/**/migrations/**"]
    timeout: 120
    
  # Ð¡Ð±Ð¾Ñ€ÐºÐ° ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ñ… Ñ„Ð°Ð¹Ð»Ð¾Ð²
  collectstatic:
    command: "cd admin_panel && source venv/bin/activate && python manage.py collectstatic --noinput"
    on_change: ["admin_panel/static/**", "admin_panel/templates/**"]
    timeout: 60

# Docker Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ
docker:
  # Ð¡Ð±Ð¾Ñ€ÐºÐ° Ð¾Ð±Ñ€Ð°Ð·Ð°
  build:
    command: "docker-compose -f docker-compose.staging.yml build admin-panel"
    on_change: ["admin_panel/Dockerfile", "admin_panel/requirements.txt"]
    timeout: 600
    
  # Ð—Ð°Ð¿ÑƒÑÐº ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
  up:
    command: "docker-compose -f docker-compose.staging.yml up -d admin-panel"
    on_change: ["docker-compose*.yml"]
    timeout: 120
    
  # ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð¾Ð²
  down:
    command: "docker-compose -f docker-compose.staging.yml stop admin-panel"
    manual: true
    timeout: 60

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ¸ Ð·Ð´Ð¾Ñ€Ð¾Ð²ÑŒÑ
health_checks:
  - name: "Admin Panel"
    url: "http://localhost:8002/admin/"
    timeout: 30
    interval: 60
    
  - name: "Docker Containers"
    command: "docker-compose -f docker-compose.staging.yml ps"
    timeout: 30
    interval: 120

# Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ
notifications:
  slack:
    webhook_url: "${SLACK_WEBHOOK_URL}"
    channel: "#apex-dev"
    
  telegram:
    bot_token: "${TELEGRAM_BOT_TOKEN}"
    chat_id: "${TELEGRAM_CHAT_ID}"
    
  email:
    smtp_host: "${EMAIL_SMTP_HOST}"
    smtp_port: "${EMAIL_SMTP_PORT}"
    username: "${EMAIL_USERNAME}"
    password: "${EMAIL_PASSWORD}"
    to: ["admin@apex-asia.com"]

# Ð¨Ð°Ð±Ð»Ð¾Ð½Ñ‹ ÐºÐ¾Ð¼Ð¼Ð¸Ñ‚Ð¾Ð²
commit_templates:
  feature: "ðŸš€ {type}: {description}"
  fix: "ðŸ› {type}: {description}"
  docs: "ðŸ“š {type}: {description}"
  style: "ðŸŽ¨ {type}: {description}"
  refactor: "â™»ï¸ {type}: {description}"
  test: "ðŸ§ª {type}: {description}"
  chore: "ðŸ”§ {type}: {description}"

# ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð·Ð°Ð´Ð°Ñ‡Ð¸
tasks:
  # Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
  daily_check:
    schedule: "0 9 * * *"
    actions:
      - "docker-compose -f docker-compose.staging.yml ps"
      - "cd admin_panel && source venv/bin/activate && python manage.py check"
      - "curl -f http://localhost:8002/admin/"
      
  # Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°
  weekly_cleanup:
    schedule: "0 10 * * 0"
    actions:
      - "docker system prune -f"
      - "cd admin_panel && find . -name '*.pyc' -delete"
      - "cd admin_panel && find . -name '__pycache__' -type d -exec rm -rf {} +"

# Ð˜Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸
integrations:
  # GitHub Actions
  github:
    enabled: true
    workflow: ".github/workflows/devloop.yml"
    
  # Docker Hub
  dockerhub:
    enabled: false
    repository: "apex-asia/admin-panel"
    
  # AWS ECR
  aws_ecr:
    enabled: false
    region: "ap-southeast-1"
    repository: "apex-admin-panel"

# ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³ Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð¾ÑÑ‚Ð¸
performance:
  # ÐœÐµÑ‚Ñ€Ð¸ÐºÐ¸
  metrics:
    - name: "Response Time"
      command: "curl -w '%{time_total}' -o /dev/null -s http://localhost:8002/admin/"
      threshold: 2.0
      
    - name: "Memory Usage"
      command: "docker stats --no-stream --format 'table {{.MemUsage}}' asia-admin-panel-staging"
      threshold: "512Mi"
      
    - name: "CPU Usage"
      command: "docker stats --no-stream --format 'table {{.CPUPerc}}' asia-admin-panel-staging"
      threshold: "80%"

# Ð›Ð¾Ð³Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
logging:
  level: "INFO"
  format: "{timestamp} [{level}] {message}"
  file: "logs/devloop.log"
  max_size: "10MB"
  backup_count: 5

# Ð‘ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ
security:
  # Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÐµÐ¹
  dependency_scan:
    command: "cd admin_panel && source venv/bin/activate && safety check"
    schedule: "0 2 * * *"
    
  # Ð¡ÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÐºÐ¾Ð´Ð°
  code_scan:
    command: "cd admin_panel && source venv/bin/activate && bandit -r ."
    schedule: "0 3 * * *"
    
  # ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° SSL
  ssl_check:
    command: "openssl s_client -connect localhost:443 -servername localhost"
    schedule: "0 4 * * *"

# Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ
backup:
  database:
    command: "docker-compose -f docker-compose.staging.yml exec db pg_dump -U asia asia_crm_staging > backup_$(date +%Y%m%d_%H%M%S).sql"
    schedule: "0 1 * * *"
    retention: 7
    
  files:
    command: "tar -czf backup_files_$(date +%Y%m%d_%H%M%S).tar.gz admin_panel/"
    schedule: "0 2 * * 0"
    retention: 4
