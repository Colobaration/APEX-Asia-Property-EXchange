# APEX Asia Property Exchange - Main Makefile
# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–º –ø—Ä–æ–µ–∫—Ç–æ–º

.PHONY: help dev install lint format test build clean docker-up docker-down docker-build docker-logs

help: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É
	@echo "APEX Asia Property Exchange - Project Management"
	@echo "==============================================="
	@echo ""
	@echo "–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "  \033[36m%-20s\033[0m %s\n", $$1, $$2}'

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
install: ## –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
	@echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
	@echo "Backend..."
	@cd backend && make install
	@echo "Frontend..."
	@cd frontend && make install
	@echo "‚úÖ –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

# –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
dev: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
	@echo "üöÄ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
	docker-compose up -d db redis
	@echo "‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö..."
	@sleep 10
	@echo "Backend..."
	@cd backend && make dev &
	@echo "Frontend..."
	@cd frontend && make dev &
	@echo "‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã"
	@echo "üì± Frontend: http://localhost:3000"
	@echo "üîß Backend API: http://localhost:8000"
	@echo "üìä API Docs: http://localhost:8000/docs"

# –õ–∏–Ω—Ç–∏–Ω–≥ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
lint: ## –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –ª–∏–Ω—Ç–µ—Ä–∞–º–∏
	@echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞..."
	@echo "Backend..."
	@cd backend && make lint
	@echo "Frontend..."
	@cd frontend && make lint
	@echo "‚úÖ –õ–∏–Ω—Ç–∏–Ω–≥ –∑–∞–≤–µ—Ä—à–µ–Ω"

lint-fix: ## –ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞
	@echo "üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –ª–∏–Ω—Ç–µ—Ä–∞..."
	@echo "Backend..."
	@cd backend && make format
	@echo "Frontend..."
	@cd frontend && make lint-fix
	@echo "‚úÖ –û—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã"

format: ## –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
	@echo "‚ú® –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞..."
	@echo "Backend..."
	@cd backend && make format
	@echo "Frontend..."
	@cd frontend && make format
	@echo "‚úÖ –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
test: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã
	@echo "üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤..."
	@echo "Backend..."
	@cd backend && make test
	@echo "Frontend..."
	@cd frontend && make test
	@echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

test-coverage: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
	@echo "üìä –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º..."
	@echo "Backend..."
	@cd backend && make test
	@echo "Frontend..."
	@cd frontend && make test-coverage
	@echo "‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º –∑–∞–≤–µ—Ä—à–µ–Ω–æ"

# –°–±–æ—Ä–∫–∞
build: ## –°–æ–±—Ä–∞—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
	@echo "üèóÔ∏è –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤..."
	@echo "Backend..."
	@cd backend && make docker-build
	@echo "Frontend..."
	@cd frontend && make docker-build
	@echo "‚úÖ –°–±–æ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# Docker –∫–æ–º–∞–Ω–¥—ã
docker-up: ## –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ Docker
	@echo "üê≥ –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Docker..."
	docker-compose up -d
	@echo "‚úÖ –°–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã"
	@echo "üì± Frontend: http://localhost:3000"
	@echo "üîß Backend API: http://localhost:8000"
	@echo "üìä API Docs: http://localhost:8000/docs"

docker-down: ## –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ Docker
	@echo "üõë –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ Docker..."
	docker-compose down
	@echo "‚úÖ –°–µ—Ä–≤–∏—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"

docker-build: ## –°–æ–±—Ä–∞—Ç—å –≤—Å–µ Docker –æ–±—Ä–∞–∑—ã
	@echo "üê≥ –°–±–æ—Ä–∫–∞ –≤—Å–µ—Ö Docker –æ–±—Ä–∞–∑–æ–≤..."
	docker-compose build
	@echo "‚úÖ –û–±—Ä–∞–∑—ã —Å–æ–±—Ä–∞–Ω—ã"

docker-logs: ## –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ Docker —Å–µ—Ä–≤–∏—Å–æ–≤
	@echo "üìã –õ–æ–≥–∏ Docker —Å–µ—Ä–≤–∏—Å–æ–≤..."
	docker-compose logs -f

# –û—á–∏—Å—Ç–∫–∞
clean: ## –û—á–∏—Å—Ç–∏—Ç—å –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
	@echo "üßπ –û—á–∏—Å—Ç–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤..."
	@echo "Backend..."
	@cd backend && make clean
	@echo "Frontend..."
	@cd frontend && make clean
	@echo "Docker..."
	docker-compose down -v
	docker system prune -f
	@echo "‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"

# –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
migrate: ## –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
	@echo "üîÑ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π..."
	@cd backend && make migrate

migrate-status: ## –ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
	@echo "üìä –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π..."
	@cd backend && make migrate-status

# –ü—Ä–æ–≤–µ—Ä–∫–∏
check-all: ## –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
	@echo "üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫..."
	@echo "Backend..."
	@cd backend && make lint
	@echo "Frontend..."
	@cd frontend && make check-all
	@echo "‚úÖ –í—Å–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ–π–¥–µ–Ω—ã"

# CI/CD
ci: ## –ö–æ–º–∞–Ω–¥—ã –¥–ª—è CI/CD
	@echo "ü§ñ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ CI/CD –∫–æ–º–∞–Ω–¥..."
	@echo "Backend..."
	@cd backend && make lint
	@echo "Frontend..."
	@cd frontend && make ci
	@echo "‚úÖ CI/CD –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω–µ–Ω—ã"

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
info: ## –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ–µ–∫—Ç–µ
	@echo "üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–µ–∫—Ç–µ:"
	@echo "  ‚Ä¢ Backend: FastAPI + SQLAlchemy + PostgreSQL"
	@echo "  ‚Ä¢ Frontend: Next.js + TypeScript + Tailwind"
	@echo "  ‚Ä¢ Database: PostgreSQL"
	@echo "  ‚Ä¢ Cache: Redis"
	@echo "  ‚Ä¢ Containerization: Docker + Docker Compose"
	@echo "  ‚Ä¢ CI/CD: GitHub Actions"
	@echo ""
	@echo "–ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:"
	@echo "  ‚Ä¢ make dev          - –ó–∞–ø—É—Å–∫ –≤ —Ä–µ–∂–∏–º–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏"
	@echo "  ‚Ä¢ make docker-up    - –ó–∞–ø—É—Å–∫ –≤ Docker"
	@echo "  ‚Ä¢ make test         - –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤"
	@echo "  ‚Ä¢ make lint         - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞"
	@echo "  ‚Ä¢ make migrate      - –ú–∏–≥—Ä–∞—Ü–∏–∏ –ë–î"

# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
quick-start: ## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞
	@echo "‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø—Ä–æ–µ–∫—Ç–∞..."
	@make install
	@make docker-up
	@echo "‚úÖ –ü—Ä–æ–µ–∫—Ç –∑–∞–ø—É—â–µ–Ω!"
	@echo "üì± Frontend: http://localhost:3000"
	@echo "üîß Backend API: http://localhost:8000"
	@echo "üìä API Docs: http://localhost:8000/docs"

