[tool:pytest]
# Конфигурация pytest для APEX

# Пути для поиска тестов
testpaths = tests

# Паттерны для поиска тестовых файлов
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Минимальная версия Python
minversion = 3.8

# Настройки для coverage
addopts = 
    --strict-markers
    --strict-config
    --verbose
    --tb=short
    --cov=app
    --cov-report=term-missing
    --cov-report=html:htmlcov
    --cov-report=xml:coverage.xml
    --cov-fail-under=80
    --cov-branch
    --cov-config=.coveragerc

# Маркеры для тестов
markers =
    unit: Unit тесты
    integration: Integration тесты
    e2e: End-to-end тесты
    slow: Медленные тесты
    security: Тесты безопасности
    api: API тесты
    database: Тесты базы данных
    webhook: Тесты webhook'ов

# Фильтры для coverage
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::UserWarning

# Настройки для async тестов
asyncio_mode = auto

# Настройки для параллельного выполнения
# -n auto для автоматического определения количества процессов
# -n 0 для отключения параллельного выполнения
# addopts = -n auto

# Настройки для повторного запуска неудачных тестов
# addopts = --reruns 3 --reruns-delay 1

# Настройки для генерации отчетов
# addopts = --junitxml=test-results.xml --html=test-report.html

# Настройки для профилирования
# addopts = --durations=10 --durations-min=1.0

# Настройки для отладки
# addopts = --pdb --pdbcls=IPython.terminal.debugger:Pdb

# Настройки для логирования
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Настройки для фильтрации тестов
# addopts = -k "not slow"  # Исключить медленные тесты
# addopts = -m "not integration"  # Исключить integration тесты

# Настройки для CI/CD
# addopts = --no-cov-on-fail  # Не генерировать coverage при неудачных тестах

# Настройки для производительности
# addopts = --durations=0  # Показать все тесты с временем выполнения
# addopts = --maxfail=5  # Остановиться после 5 неудачных тестов

# Настройки для отладки
# addopts = --tb=long  # Подробный traceback
# addopts = --capture=no  # Показать print statements

# Настройки для мокирования
# addopts = --mock  # Автоматическое мокирование

# Настройки для изоляции тестов
# addopts = --strict-markers  # Строгая проверка маркеров
# addopts = --disable-warnings  # Отключить предупреждения

# Настройки для отчетов
# addopts = --html=reports/test-report.html --self-contained-html
# addopts = --json=reports/test-results.json

# Настройки для coverage в CI
# addopts = --cov-report=xml:coverage.xml --cov-report=term-missing

# Настройки для параллельного выполнения в CI
# addopts = -n auto --dist=loadfile

# Настройки для кэширования
# addopts = --cache-clear  # Очистить кэш перед запуском

# Настройки для профилирования памяти
# addopts = --memray  # Профилирование использования памяти

# Настройки для статического анализа
# addopts = --pylint  # Запуск pylint
# addopts = --flake8  # Запуск flake8

# Настройки для безопасности
# addopts = --bandit  # Запуск bandit для проверки безопасности

# Настройки для документации
# addopts = --doctest-modules  # Запуск doctest

# Настройки для производительности
# addopts = --benchmark-only  # Только benchmark тесты
# addopts = --benchmark-skip  # Пропустить benchmark тесты

# Настройки для отладки в IDE
# addopts = --pdbcls=IPython.terminal.debugger:Pdb

# Настройки для логирования в файл
# log_file = test.log
# log_file_level = DEBUG
# log_file_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
# log_file_date_format = %Y-%m-%d %H:%M:%S
