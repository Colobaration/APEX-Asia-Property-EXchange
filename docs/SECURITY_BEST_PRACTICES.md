# üîê –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è APEX Asia Property Exchange

## üéØ –û–±–∑–æ—Ä

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏ –∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Å—Ä–µ–¥ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è.

## üìã –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö

### üî¥ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ä–µ—Ç—ã (–≤—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets)
- `SECRET_KEY` - —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- `JWT_SECRET` - —Å–µ–∫—Ä–µ—Ç –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤
- `AMOCRM_CLIENT_SECRET` - —Å–µ–∫—Ä–µ—Ç AmoCRM
- `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞
- `WHATSAPP_API_KEY` - –∫–ª—é—á WhatsApp API
- `EMAIL_PASSWORD` - –ø–∞—Ä–æ–ª—å email —Å–µ—Ä–≤–µ—Ä–∞

### üü° –í–∞–∂–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets –≤ production)
- `AMOCRM_CLIENT_ID` - ID –∫–ª–∏–µ–Ω—Ç–∞ AmoCRM
- `AMOCRM_REDIRECT_URI` - URI –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è AmoCRM
- `AMOCRM_SUBDOMAIN` - –ø–æ–¥–¥–æ–º–µ–Ω AmoCRM
- `TELEGRAM_CHAT_ID` - ID —á–∞—Ç–∞ Telegram
- `EMAIL_USERNAME` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è email
- `EMAIL_FROM` - –∞–¥—Ä–µ—Å –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è email

### üü¢ –û–±—ã—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (–º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –≤ docker-compose)
- `ENVIRONMENT` - –æ–∫—Ä—É–∂–µ–Ω–∏–µ (development/staging/production)
- `DEBUG` - —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏
- `LOG_LEVEL` - —É—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
- `DATABASE_URL` - URL –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- `REDIS_URL` - URL Redis
- `ALLOWED_HOSTS_RAW` - —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ —Ö–æ—Å—Ç—ã
- `CORS_ORIGINS_RAW` - CORS origins

## üê≥ Docker Secrets (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è production)

### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –ª–æ–≥–∏
- ‚úÖ –°–µ–∫—Ä–µ—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑–∞—Ö
- ‚úÖ –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ –ø–æ–∫–æ—è
- ‚úÖ –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤
```bash
# –ò–∑ —Ñ–∞–π–ª–∞ .env
./scripts/manage-secrets.sh create-from-file .env.production

# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ
./scripts/manage-secrets.sh interactive

# –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–µ–∫—Ä–µ—Ç–æ–≤
./scripts/manage-secrets.sh list
```

#### 2. –í docker-compose.yml
```yaml
services:
  backend:
    secrets:
      - secret_key
      - jwt_secret
      - amocrm_client_id
      - amocrm_client_secret
    environment:
      - ENVIRONMENT=production
      # –û–±—ã—á–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

secrets:
  secret_key:
    external: true
  jwt_secret:
    external: true
```

#### 3. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
```python
# –°–µ–∫—Ä–µ—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –∫–∞–∫ —Ñ–∞–π–ª—ã –≤ /run/secrets/
import os

def get_secret(secret_name: str) -> str:
    secret_file = f"/run/secrets/{secret_name}"
    if os.path.exists(secret_file):
        with open(secret_file, 'r') as f:
            return f.read().strip()
    return os.getenv(secret_name, "")
```

## üåç –û–∫—Ä—É–∂–µ–Ω–∏—è

### Development
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ .env —Ñ–∞–π–ª—ã
cp env.example .env.development
# –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env.development
docker-compose -f docker-compose.yml up
```

### Staging
```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å fallback
docker-compose -f docker-compose.staging.yml up
```

### Production
```bash
# 1. –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
./scripts/manage-secrets.sh interactive

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å —Å–µ–∫—Ä–µ—Ç–∞–º–∏
docker-compose -f docker-compose.production.yml up
```

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

### AmoCRM
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ AmoCRM
2. –ü–æ–ª—É—á–∏—Ç–µ `CLIENT_ID` –∏ `CLIENT_SECRET`
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ `REDIRECT_URI`
4. –£–∫–∞–∂–∏—Ç–µ `SUBDOMAIN`

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
echo "your-amocrm-client-id" | docker secret create amocrm_client_id -
echo "your-amocrm-client-secret" | docker secret create amocrm_client_secret -
```

### Telegram
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather
2. –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞
3. –ü–æ–ª—É—á–∏—Ç–µ ID —á–∞—Ç–∞

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
echo "your-telegram-bot-token" | docker secret create telegram_bot_token -
echo "your-chat-id" | docker secret create telegram_chat_id -
```

### WhatsApp Business API
1. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –≤ WhatsApp Business API
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
echo "your-whatsapp-api-key" | docker secret create whatsapp_api_key -
```

### Email (SMTP)
1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ SMTP —Å–µ—Ä–≤–µ—Ä
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ-–ø–∞—Ä–æ–ª—å (–¥–ª—è Gmail)
3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
echo "your-email-password" | docker secret create email_password -
echo "your-email-username" | docker secret create email_username -
```

## üõ°Ô∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. –†–æ—Ç–∞—Ü–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞
echo "new-secret-value" | docker secret create secret_key_new -
# –û–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker secret rm secret_key_old
```

### 2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤
docker secret ls
docker service ls
```

### 3. –†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
# –≠–∫—Å–ø–æ—Ä—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ (—Ç–æ–ª—å–∫–æ –¥–ª—è backup)
docker secret inspect secret_name
```

### 4. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ª–æ–≥–∞—Ö
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –Ω–∞ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å

## üö® –í–∞–∂–Ω—ã–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è

### ‚ùå –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–µ–ª–∞–π—Ç–µ:
- –ù–µ –∫–æ–º–º–∏—Ç—å—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ git
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è—Ö
- –ù–µ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
- –ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
- –ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏

### ‚úÖ –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ:
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker Secrets –≤ production
- –†–µ–≥—É–ª—è—Ä–Ω–æ —Ä–æ—Ç–∏—Ä—É–π—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏
- –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –¥–æ—Å—Ç—É–ø –∫ —Å–µ–∫—Ä–µ—Ç–∞–º
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [Docker Secrets Documentation](https://docs.docker.com/engine/swarm/secrets/)
- [AmoCRM API Documentation](https://www.amocrm.ru/developers)
- [Telegram Bot API](https://core.telegram.org/bots/api)
- [WhatsApp Business API](https://developers.facebook.com/docs/whatsapp)
- [SMTP Security Best Practices](https://tools.ietf.org/html/rfc8314)

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
```bash
#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤

# 1. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
./scripts/manage-secrets.sh interactive

# 2. –û–±–Ω–æ–≤–∏—Ç–µ docker-compose.yml
# 3. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose -f docker-compose.production.yml up -d

# 4. –£–¥–∞–ª–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Å–µ–∫—Ä–µ—Ç—ã
./scripts/manage-secrets.sh remove-all
```

---
*–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª–µ–Ω: $(date)*
