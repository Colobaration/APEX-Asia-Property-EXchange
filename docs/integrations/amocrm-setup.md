# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å amoCRM

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ –æ—Ç –≤–∞—Å

### 1. –î–∞–Ω–Ω—ã–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
–î–ª—è –ø–æ–ª–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤–∞–º –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏—Ç—å:

```
‚úÖ Client ID (ID –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ amoCRM)
‚úÖ Client Secret (—Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)  
‚úÖ –î–æ–º–µ–Ω amoCRM (–Ω–∞–ø—Ä–∏–º–µ—Ä: your-company.amocrm.ru)
‚úÖ Redirect URI (URL –¥–ª—è callback)
```

### 2. –î–æ—Å—Ç—É–ø –∫ amoCRM
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–∫–∫–∞—É–Ω—Ç—É amoCRM
- –ü—Ä–∞–≤–∞ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- –ü—Ä–∞–≤–∞ –Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫—É –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π –∏ –≤–æ—Ä–æ–Ω–æ–∫

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ amoCRM

1. **–í–æ–π–¥–∏—Ç–µ –≤ amoCRM** –ø–æ–¥ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º
2. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Üí **–°–æ–∑–¥–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é**
3. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É:**
   - –ù–∞–∑–≤–∞–Ω–∏–µ: `Asia Deals CRM Integration`
   - –û–ø–∏—Å–∞–Ω–∏–µ: `–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–¥–∞–∂ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏`
   - –¢–∏–ø: `–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ`
   - Redirect URI: `http://localhost:8000/api/auth/amo/callback` (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –∏ –ø–æ–ª—É—á–∏—Ç–µ:
   - Client ID
   - Client Secret

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

1. **–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** –ø–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "OAuth2"
2. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:**
   - ‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã (—á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å)
   - ‚úÖ –°–¥–µ–ª–∫–∏ (—á—Ç–µ–Ω–∏–µ, –∑–∞–ø–∏—Å—å)
   - ‚úÖ –ö–æ–º–ø–∞–Ω–∏–∏ (—á—Ç–µ–Ω–∏–µ)
   - ‚úÖ –í–æ—Ä–æ–Ω–∫–∏ (—á—Ç–µ–Ω–∏–µ)
3. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**

### –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –ø–æ–ª–µ–π

#### –î–ª—è –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤:
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ü–æ–ª—è –∏ –≤–æ—Ä–æ–Ω–∫–∏** ‚Üí **–ö–æ–Ω—Ç–∞–∫—Ç—ã**
2. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—è —Å —Ç–æ—á–Ω—ã–º–∏ ID:**

| –ü–æ–ª–µ | ID | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------|----|-----|-------------|
| –¢–µ–ª–µ—Ñ–æ–Ω | 123456 | –¢–µ–ª–µ—Ñ–æ–Ω | ‚úÖ |
| Email | 123457 | Email | ‚ùå |
| UTM Source | 123458 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Medium | 123459 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Campaign | 123460 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Content | 123461 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Term | 123462 | –¢–µ–∫—Å—Ç | ‚ùå |

#### –î–ª—è —Å–¥–µ–ª–æ–∫:
1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ü–æ–ª—è –∏ –≤–æ—Ä–æ–Ω–∫–∏** ‚Üí **–°–¥–µ–ª–∫–∏**
2. **–°–æ–∑–¥–∞–π—Ç–µ –ø–æ–ª—è:**

| –ü–æ–ª–µ | ID | –¢–∏–ø | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------|----|-----|-------------|
| UTM Source | 123458 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Medium | 123459 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Campaign | 123460 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Content | 123461 | –¢–µ–∫—Å—Ç | ‚ùå |
| UTM Term | 123462 | –¢–µ–∫—Å—Ç | ‚ùå |
| –°—Ç–æ–∏–º–æ—Å—Ç—å –æ–±—ä–µ–∫—Ç–∞ | 123463 | –ß–∏—Å–ª–æ | ‚ùå |
| –ö–æ–º–∏—Å—Å–∏—è | 123464 | –ß–∏—Å–ª–æ | ‚ùå |
| –û–±—ä–µ–∫—Ç | 123466 | –°–ø–∏—Å–æ–∫ | ‚ùå |
| –°—Ç–∞—Ç—É—Å –æ–ø–ª–∞—Ç—ã | 123467 | –°–ø–∏—Å–æ–∫ | ‚ùå |

### –®–∞–≥ 4: –°–æ–∑–¥–∞–Ω–∏–µ –≤–æ—Ä–æ–Ω–∫–∏ "Asia Deals"

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–í–æ—Ä–æ–Ω–∫–∏** ‚Üí **–°–æ–∑–¥–∞—Ç—å –≤–æ—Ä–æ–Ω–∫—É**
2. **–ù–∞–∑–≤–∞–Ω–∏–µ:** `Asia Deals`
3. **–î–æ–±–∞–≤—å—Ç–µ —Å—Ç–∞—Ç—É—Å—ã:**

| –°—Ç–∞—Ç—É—Å | ID | –ù–∞–∑–≤–∞–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|----|----------|----------|
| 1 | 1 | –ù–æ–≤—ã–π –ª–∏–¥ | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç |
| 2 | 2 | –ü–µ—Ä–≤–∏—á–Ω—ã–π –∫–æ–Ω—Ç–∞–∫—Ç | –ó–≤–æ–Ω–æ–∫ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ |
| 3 | 3 | –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è | –ü–æ–∫–∞–∑ –æ–±—ä–µ–∫—Ç–æ–≤ |
| 4 | 4 | –í—ã–±–æ—Ä –æ–±—ä–µ–∫—Ç–∞ | –ö–ª–∏–µ–Ω—Ç –≤—ã–±—Ä–∞–ª –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å |
| 5 | 5 | –†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ | –í–Ω–µ—Å–µ–Ω–∏–µ –¥–µ–ø–æ–∑–∏—Ç–∞ |
| 6 | 6 | –°–¥–µ–ª–∫–∞ | –ó–∞–∫—Ä—ã—Ç–∏–µ —Å–¥–µ–ª–∫–∏ |
| 7 | 7 | –ó–∞–≤–µ—Ä—à–µ–Ω–æ | –£—Å–ø–µ—à–Ω–∞—è —Å–¥–µ–ª–∫–∞ |

### –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ webhooks

1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∏** ‚Üí **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏** ‚Üí **Webhooks**
2. **–î–æ–±–∞–≤—å—Ç–µ webhook:**
   - URL: `http://your-domain.com/api/webhooks/amo`
   - –°–æ–±—ã—Ç–∏—è:
     - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤
     - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ª–∏–¥–æ–≤
     - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤
     - ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤

### –®–∞–≥ 6: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ `.env.example` –≤ `.env`**
2. **–ó–∞–ø–æ–ª–Ω–∏—Ç–µ amoCRM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:**

```bash
# amoCRM Configuration
AMOCRM_CLIENT_ID=your_client_id_here
AMOCRM_CLIENT_SECRET=your_client_secret_here
AMOCRM_REDIRECT_URI=http://localhost:8000/api/auth/amo/callback
AMOCRM_DOMAIN=your-company.amocrm.ru
AMOCRM_REFRESH_TOKEN=your_refresh_token_here
```

### –®–∞–≥ 7: –ü–æ–ª—É—á–µ–Ω–∏–µ refresh token

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** `docker-compose up`
2. **–û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ:** `http://localhost:8000/api/auth/amo`
3. **–ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ amoCRM**
4. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ refresh token** –∏–∑ –ª–æ–≥–æ–≤ –∏–ª–∏ callback URL
5. **–î–æ–±–∞–≤—å—Ç–µ –≤ .env —Ñ–∞–π–ª**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
```bash
curl -X GET http://localhost:8000/api/auth/amo/status
```

### –¢–µ—Å—Ç 2: –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ª–∏–¥–∞
```bash
curl -X POST http://localhost:8000/api/leads/ \
  -H "Content-Type: application/json" \
  -d '{
    "name": "–¢–µ—Å—Ç –¢–µ—Å—Ç–æ–≤",
    "phone": "+79001234567",
    "email": "test@example.com",
    "utm_source": "google",
    "utm_medium": "cpc",
    "utm_campaign": "asia_deals_test"
  }'
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ webhooks
```bash
curl -X POST http://localhost:8000/api/webhooks/amo \
  -H "Content-Type: application/json" \
  -d '{
    "leads": {
      "add": [{"id": 123, "name": "–¢–µ—Å—Ç–æ–≤–∞—è —Å–¥–µ–ª–∫–∞"}]
    }
  }'
```

## üîß –í–∞—Ä–∏–∞–Ω—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–∞—Ä–∏–∞–Ω—Ç A: –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–∞–∫—Ç–æ–≤ –∏ —Å–¥–µ–ª–æ–∫
- ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å—Ç–∞—Ç—É—Å–æ–≤ —á–µ—Ä–µ–∑ webhooks
- ‚úÖ Email –∏ WhatsApp –≤–æ—Ä–æ–Ω–∫–∏
- ‚úÖ –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –∏ –¥–∞—à–±–æ—Ä–¥—ã
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç B: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ª–∏–¥–æ–≤ –≤ amoCRM
- ‚ùå –†—É—á–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏
- ‚ùå –ë–∞–∑–æ–≤–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
- ‚ùå –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç C: –¢–µ—Å—Ç–æ–≤–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ amoCRM
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
- ‚úÖ –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ

## üö® –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: "Invalid client_id"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Client ID –≤ .env —Ñ–∞–π–ª–µ

### –ü—Ä–æ–±–ª–µ–º–∞ 2: "Access token expired"
**–†–µ—à–µ–Ω–∏–µ:** –û–±–Ω–æ–≤–∏—Ç–µ refresh token –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö

### –ü—Ä–æ–±–ª–µ–º–∞ 3: "Field not found"
**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –ø–æ–ª—è —Å–æ–∑–¥–∞–Ω—ã —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ ID

### –ü—Ä–æ–±–ª–µ–º–∞ 4: "Webhook not received"
**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL webhook –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–µ—Ä–∞

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:** `docker-compose logs backend`
2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å:** `http://localhost:8000/health`
3. **–û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** `/docs` –¥–ª—è API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
4. **–°–æ–∑–¥–∞–π—Ç–µ issue** –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ email –≤–æ—Ä–æ–Ω–∫–∏** (SMTP)
2. **–ü–æ–¥–∫–ª—é—á–∏—Ç–µ WhatsApp API**
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–∞—à–±–æ—Ä–¥—ã**
4. **–ü—Ä–æ–≤–µ–¥–∏—Ç–µ –Ω–∞–≥—Ä—É–∑–æ—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
5. **–†–∞–∑–≤–µ—Ä–Ω–∏—Ç–µ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω**

---

**–ì–æ—Ç–æ–≤–æ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏!** üöÄ

–ü—Ä–µ–¥–æ—Å—Ç–∞–≤—å—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è amoCRM, –∏ —è –ø–æ–º–æ–≥—É –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–Ω—É—é –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é.
